<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<form class="form-horizontal" id="inboxForm" method="post"
      role="form" style="width: 600px; text-align: center;">

    <div class="form-group">
        <label class="col-sm-3 control-label" for="firstname"
               style="margin-top: 40px;">LOGO</label>
        <divtest class="col-sm-4">
            <div id="Imgdiv">
                <img class="img-circle" height="100px" id="Img" src="img/logo1.png"
                     width="100px"/>
            </div>
        </divtest>
        <div class="col-sm-4" style="margin-top: 40px;">
            <button class="btn btn-default" onclick="uploadLogo()" type="button">
                <i class="glyphicon glyphicon-cloud-upload"></i> 选择logo图片
            </button>
            <input accept="image/*" name="uploadFile" onchange="change_photo()"
                   required="required" style="display:none" type="file">
        </div>
    </div>


    <div class="form-group">
        <label class="col-sm-3 control-label">收件夹名称</label>
        <div class="col-sm-8">
            <input class="form-control" name="title" placeholder="设置收件名称"
                   required="required" type="text">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-3 control-label">收件夹说明</label>
        <div class="col-sm-8">
			<textarea class="form-control" name="remark" placeholder="少侠！说点什么吧"
                      required="required" rows="5"></textarea>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-3 control-label" for="lastname">截止时间</label>
        <div class="col-sm-4">
            <input class="form-control" id="endTime" name="endTime" required="required"
                   type="text">
        </div>
        <p class="help-block" style="font-size: 12px;">截止时间最长一个月</p>
    </div>
    <div class="form-group">
        <div class="col-sm-3 col-sm-offset-8">
            <button class="btn btn-success" type="submit">
                <i class="glyphicon glyphicon-ok"></i> 提交
            </button>
        </div>
    </div>
</form>
<script>
    $("#inboxForm").submit(function (e) {
        var form = new FormData(document.getElementById("inboxForm"));
        $.ajax({
            url: getWebProjectName() + '/inbox!addInbox.action',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            success: function (data) {
                if (data.status) {
                    loadInbox();
                    layer.close(layer.index);
                    showSuccessMsg(data.msg);
                } else {
                    showErrorMsg(data.msg);
                }
            }
        })

        return false;
    });

    $('#endTime').datetimepicker({
        lang: 'ch',
        timepicker: false,
        format: 'Y-m-d',
        minDate: '-1970/01/01',
        maxDate: getdateLastMonth(),
    });

    function uploadLogo() {
        $("input[name='uploadFile']").click();
    }

    function change_photo() {
        PreviewImage($("input[name='uploadFile']")[0], 'Img', 'Imgdiv');
    }

    function PreviewImage(fileObj, imgPreviewId, divPreviewId) {
        var allowExtention = ".jpg,.bmp,.gif,.png,.jpeg";//允许上传文件的后缀名document.getElementById("hfAllowPicSuffix").value;
        var extention = fileObj.value.substring(
            fileObj.value.lastIndexOf(".") + 1).toLowerCase();
        var browserVersion = window.navigator.userAgent.toUpperCase();
        if (allowExtention.indexOf(extention) > -1) {
            if (fileObj.files) {//HTML5实现预览，兼容chrome、火狐7+等
                if (window.FileReader) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById(imgPreviewId).setAttribute(
                            "src", e.target.result);
                    }
                    reader.readAsDataURL(fileObj.files[0]);
                } else if (browserVersion.indexOf("SAFARI") > -1) {
                    alert("不支持Safari6.0以下浏览器的图片预览!");
                }
            } else if (browserVersion.indexOf("MSIE") > -1) {
                if (browserVersion.indexOf("MSIE 6") > -1) {//ie6
                    document.getElementById(imgPreviewId).setAttribute("src",
                        fileObj.value);
                } else {//ie[7-9]
                    fileObj.select();
                    if (browserVersion.indexOf("MSIE 9") > -1)
                        fileObj.blur();//不加上document.selection.createRange().text在ie9会拒绝访问
                    var newPreview = document.getElementById(divPreviewId
                        + "New");
                    if (newPreview == null) {
                        newPreview = document.createElement("div");
                        newPreview.setAttribute("id", divPreviewId + "New");
                        newPreview.style.width = document
                                .getElementById(imgPreviewId).width
                            + "px";
                        newPreview.style.height = document
                                .getElementById(imgPreviewId).height
                            + "px";
                        newPreview.style.border = "solid 1px #d2e2e2";
                    }
                    newPreview.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"
                        + document.selection.createRange().text + "')";
                    var tempDivPreview = document.getElementById(divPreviewId);
                    tempDivPreview.parentNode.insertBefore(newPreview,
                        tempDivPreview);
                    tempDivPreview.style.display = "none";
                }
            } else if (browserVersion.indexOf("FIREFOX") > -1) {//firefox
                var firefoxVersion = parseFloat(browserVersion.toLowerCase()
                    .match(/firefox\/([\d.]+)/)[1]);
                if (firefoxVersion < 7) {//firefox7以下版本
                    document.getElementById(imgPreviewId).setAttribute("src",
                        fileObj.files[0].getAsDataURL());
                } else {//firefox7.0+
                    document.getElementById(imgPreviewId).setAttribute("src",
                        window.URL.createObjectURL(fileObj.files[0]));
                }
            } else {
                document.getElementById(imgPreviewId).setAttribute("src",
                    fileObj.value);
            }
        } else {
            alert("仅支持" + allowExtention + "为后缀名的文件!");
            fileObj.value = "";//清空选中文件
            if (browserVersion.indexOf("MSIE") > -1) {
                fileObj.select();
                document.selection.clear();
            }
            fileObj.outerHTML = fileObj.outerHTML;
        }
    }


</script>
</body>
</html>